events {
    worker_connections 1024;
}

stream {
    upstream kafka_connect {
        server node-1.intel.r7g.org:8080;
        server node-2.intel.r7g.org:8080;
        server node-3.intel.r7g.org:8080;
    }

    server {
        listen 443 ssl;
        ssl_certificate /data/cluster/certificates/nodes/node-0.intel.r7g.org/node-0.intel.r7g.org.crt;
        ssl_certificate_key /data/cluster/certificates/nodes/node-0.intel.r7g.org/node-0.intel.r7g.org.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 10m;

        proxy_pass kafka_connect;
        proxy_ssl on;
        proxy_ssl_protocols TLSv1.3;
        proxy_ssl_session_reuse on;
        proxy_ssl_trusted_certificate /data/cluster/certificates/CA/ca.crt;
    }
}
