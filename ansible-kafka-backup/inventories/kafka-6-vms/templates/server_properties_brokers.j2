# Node ID
node.id={{ node_id }}

# Define the roles for this node (controller and broker)
process.roles=broker
controller.listener.names=CONTROLPLANE-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}
controller.quorum.voters={% for host in (groups['combined'] | default([])) + (groups['controllers'] | default([])) %}
{{ hostvars[host]['node_id'] }}@{{ hostvars[host]['hostname'] }}:{{ hostvars[inventory_hostname]['port_control_plane_ext'] }}{% if not loop.last %},{% endif %}{% endfor %}

# Unique cluster ID that must match across all nodes (controller and broker)
cluster.id=AkU3OEVBNTcwNTJENDM2Qk

##########
# Listener - Control Plane (controller-broker via mTLS)
##########
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.client.auth=required
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.keystore.location=/etc/kafka/secrets/{{ hostvars[inventory_hostname]['hostname'] }}.keystore.p12
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.keystore.password=changeme
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.keystore.type=PKCS12
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.truststore.location=/etc/kafka/secrets/shared.truststore.jks
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.truststore.password=changeme
listener.name.controlplane-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}.ssl.truststore.type=PKCS12

##########
# Listener - Replication (broker-broker via mTLS)
##########
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.client.auth=required
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.keystore.location=/etc/kafka/secrets/{{ hostvars[inventory_hostname]['hostname'] }}.keystore.p12
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.keystore.password=changeme
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.keystore.type=PKCS12
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.truststore.location=/etc/kafka/secrets/shared.truststore.jks
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.truststore.password=changeme
listener.name.replication-{{ hostvars[inventory_hostname]['port_replication_int'] }}.ssl.truststore.type=PKCS12

##########
# Listener - Consumers (client-broker via mTLS)
##########
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.client.auth=required
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.keystore.location=/etc/kafka/secrets/{{ hostvars[inventory_hostname]['hostname'] }}.keystore.p12
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.keystore.password=changeme
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.keystore.type=PKCS12
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.truststore.location=/etc/kafka/secrets/shared.truststore.jks
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.truststore.password=changeme
listener.name.consumers-mtls-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}.ssl.truststore.type=PKCS12


##########
# Listener - Consumers (client-broker via SASL_SSL)
##########
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.scram-sha-512.sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required username="admin" password="changeme";
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.sasl.enabled.mechanisms=SCRAM-SHA-512
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.ssl.keystore.location=/etc/kafka/secrets/{{ hostvars[inventory_hostname]['hostname'] }}.keystore.p12
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.ssl.keystore.password=changeme
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.ssl.keystore.type=PKCS12
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.ssl.truststore.location=/etc/kafka/secrets/shared.truststore.jks
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.ssl.truststore.password=changeme
listener.name.consumers-sasl-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}.ssl.truststore.type=PKCS12

##########
# Common listener configuration
##########
advertised.listeners=REPLICATION-{{ hostvars[inventory_hostname]['port_replication_int'] }}://{{ hostvars[inventory_hostname]['hostname'] }}:{{ hostvars[inventory_hostname]['port_replication_int'] }},CONSUMERS-MTLS-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}://{{ hostvars[inventory_hostname]['hostname'] }}:{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }},CONSUMERS-SASL-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}://{{ hostvars[inventory_hostname]['hostname'] }}:{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}
inter.broker.listener.name=REPLICATION-{{ hostvars[inventory_hostname]['port_replication_int'] }}
listener.security.protocol.map=CONTROLPLANE-{{ hostvars[inventory_hostname]['port_control_plane_int'] }}:SSL,REPLICATION-{{ hostvars[inventory_hostname]['port_replication_int'] }}:SSL,CONSUMERS-MTLS-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}:SSL,CONSUMERS-SASL-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}:SASL_SSL
listeners=REPLICATION-{{ hostvars[inventory_hostname]['port_replication_int'] }}://:{{ hostvars[inventory_hostname]['port_replication_int'] }},CONSUMERS-MTLS-{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }}://:{{ hostvars[inventory_hostname]['port_consumer_mtls_int'] }},CONSUMERS-SASL-{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}://:{{ hostvars[inventory_hostname]['port_consumer_sasl_int'] }}
sasl.enabled.mechanisms=
ssl.endpoint.identification.algorithm=HTTPS

##########
# Authorization
##########
authorizer.class.name=org.apache.kafka.metadata.authorizer.StandardAuthorizer
super.users=User:CN=node-1.intel.r7g.org;User:CN=node-2.intel.r7g.org;User:CN=node-3.intel.r7g.org;User:CN=node-4.intel.r7g.org;User:CN=node-5.intel.r7g.org;User:CN=node-6.intel.r7g.org;User:node-1.intel.r7g.org;User:node-2.intel.r7g.org;User:node-3.intel.r7g.org;User:node-4.intel.r7g.org;User:node-5.intel.r7g.org;User:node-6.intel.r7g.org;User:CN=admin;User:admin;

##########
# User provided configuration
##########
default.replication.factor=1
min.insync.replicas=1
offsets.topic.replication.factor=1
transaction.state.log.min.isr=1
transaction.state.log.replication.factor=1


#############################################################################################
# Data and Metadata Storage

# # Directory where the broker data are stored
log.dirs=/var/lib/kafka/data

# # Directory where the broker metadata are stored
metadata.log.dir=/var/lib/kafka/meta
