---
# INSTALL
- name: Install Portainer on all nodes
  tags: gui_portainer_install
  vars:
    container: "{{ gui_portainer[0] }}"
  docker_container:
    name: "{{ container.name }}"
    image: "{{ container.image }}"
    hostname: "{{ container.hostname }}"
    restart_policy: "{{ container.restart_policy | default('always') }}"
    published_ports: "{{ container.published_ports | default([]) }}"
    memory: "{{ container.memory | default(omit) }}"
    volumes: "{{ container.volumes | default([]) }}"
    env_file: "{{ container.env_file | default(omit) }}"
    env: "{{ container.env | default({}) }}"
    command: "{{ container.command | default(omit) }}"
    healthcheck: "{{ container.healthcheck | default(omit) }}"
    state: started

# START
- name: Start Portainer on all nodes
  tags: gui_portainer_start
  vars:
    container: "{{ gui_portainer[0] }}"
  docker_container:
    name: "{{ container.name }}"
    state: started

# RESTART
- name: Restart Portainer on all nodes
  tags: gui_portainer_restart
  vars:
    container: "{{ gui_portainer[0] }}"
  docker_container:
    name: "{{ container.name }}"
    state: started
    restart: true

# STOP
- name: Stop Portainer on all nodes
  tags: gui_portainer_stop
  vars:
    container: "{{ gui_portainer[0] }}"
  docker_container:
    name: "{{ container.name }}"
    state: stopped

# UNINSTALL
- name: Uninstall Portainer on all nodes
  tags: gui_portainer_uninstall
  vars:
    container: "{{ gui_portainer[0] }}"
  docker_container:
    name: "{{ container.name }}"
    state: absent
    force_kill: true

- name: Remove portainer_data volume on all nodes
  tags: gui_portainer_uninstall
  docker_volume:
    name: "portainer_datas"
    state: absent
