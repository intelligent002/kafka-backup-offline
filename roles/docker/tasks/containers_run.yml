---
- name: Gather facts for all nodes
  tags:
    - containers_run
  setup:
  delegate_to: "{{ item }}"
  with_items: "{{ startup_order }}"

- name: Store gathered RAM per node on localhost
  tags:
    - containers_run
  set_fact:
    global_node_ram: "{{ global_node_ram | default({}) | combine({ item: (ansible_memtotal_mb / 1024) | round | int }) }}"
  delegate_to: localhost
  with_items: "{{ startup_order }}"

- name: Debug RAM per node (Using `global_node_ram`)
  tags:
    - containers_run
  debug:
    msg: "Node: {{ item }} - Total RAM: {{ global_node_ram[item] | default('N/A') }} GB"
  with_items: "{{ startup_order }}"
  run_once: true
