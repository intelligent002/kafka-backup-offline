---
- name: Retrieve RAM size for each node
  tags:
    - containers_run
  delegate_to: "{{ item }}"
  shell: "awk '/MemTotal/ {print $2}' /proc/meminfo"
  register: ram_output
  with_items: "{{ startup_order }}"

- name: Process and Store RAM Data Globally
  tags:
    - containers_run
  set_fact:
    global_node_ram: >-
      {{ global_node_ram | default({}) | combine({ item.item: (item.stdout | int / 1024) | round | int }) }}
  delegate_to: localhost
  with_items: "{{ ram_output.results }}"
  run_once: true
  no_log: true

- name: Debug RAM per node (Using `global_node_ram`)
  tags:
    - containers_run
  debug:
    msg: "Node: {{ item }} - Total RAM: {{ global_node_ram[item] | default('N/A') }} GB"
  with_items: "{{ startup_order }}"
  run_once: true

