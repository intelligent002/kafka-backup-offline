---
- name: Retrieve RAM size for each node
  tags:
    - containers_run
  delegate_to: "{{ item }}"
  shell: "awk '/MemTotal/ {print $2}' /proc/meminfo"
  register: ram_output
  with_items: "{{ startup_order }}"

- name: Debug Processed RAM per Node (Clean Output)
  tags:
    - containers_run
  debug:
    msg: >-
      {{
        ram_output.results | map(attribute='item') | list | zip(
        ram_output.results | map(attribute='stdout') | map('int') | map('regex_replace', '^(.+)$', '\1') | map('int') | map('abs') | map('floordiv', 1024) | map('string') | list
        ) | map('join', ' -> Total RAM: ') | map('regex_replace', '$', ' MB') | list
      }}
  run_once: true
  delegate_to: localhost

- name: Debug RAM per node (Using `global_node_ram`)
  tags:
    - containers_run
  debug:
    msg: "Node: {{ item }} - Total RAM: {{ global_node_ram[item] | default('N/A') }} GB"
  with_items: "{{ startup_order }}"
  run_once: true

